<template>
    <page-header title="Lobby" subtitle="available games appear here"></page-header>

    <div class="row">
        <div class="col">
            <game-stat stat.to-view="availableGamesTotal" title="Games available"></game-stat>
        </div>
        <div class="col">
            <game-stat stat.to-view="playersGamesTotal" title="My games"></game-stat>
        </div>
        <div class="col text-right">
            <button type="button" class="btn btn-secondary" click.delegate="refreshGames()">
                Refresh
            </button>
            <a class="btn btn-primary" route-href="route.bind: 'newgame'">
                Host a new game
            </a>
        </div>
    </div>

    <hr />

    <div class="row">
        <div class="col">
            <div if.bind="availableGamesLoading">
                <div class="m-5">
                    <p class="text-center" aria-hidden="true">
                        <i class="fas fa-spinner fa-pulse"></i>
                    </p>
                    <p class="text-center">
                        Loading available games...
                    </p>
                </div>

            </div>
            <table if.bind="!availableGamesLoading" class="table table-hover table-borderless">
                <thead>
                    <tr>
                        <th>Host player</th>
                        <th>Size</th>
                        <th>Mines</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr repeat.for="availableGame of availableGames">
                        <td>${ availableGame.hostPlayerDisplayName }</td>
                        <td>${ availableGame.rows }&times;${ availableGame.columns }</td>
                        <td>${ availableGame.mines }</td>
                        <td>
                            <form submit.delegate="joinGame(availableGame.gameId)">
                                <button type="submit" class="btn btn-primary">Join</button>
                            </form>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <template if.bind="playersGamesLoading">
        <p class="text-center" aria-hidden="true">
            <i class="fas fa-spinner fa-pulse"></i>
        </p>
        <p class="text-center">
            Loading your active games...
        </p>
    </template>

    <template if.bind="!playersGamesLoading">
        <div class="row">
            <div class="col">
                <h1 class="h5 py-3">
                    Your active games
                </h1>
            </div>
        </div>

        <template repeat.for="playersGame of playersGames">

            <div class="row py-1 align-items-center" style="background-color: #f8f8f8;border-top: 1px solid #eaeaea;">
                <div class="col-6">
                    <div class="media">
                        <img class="mr-3 mt-1" src="http://placehold.it/32x32"
                            alt="Avatar of ${ playersGame.otherPlayerDisplayName }" />
                        <div class="media-body">

                            <template if.one-time="playersGame.otherPlayerDisplayName">
                                <small class="text-muted">Playing against</small>
                                <p class="h6 m-0">
                                    ${ playersGame.otherPlayerDisplayName }
                                </p>
                            </template>

                            <template if.one-time="!playersGame.otherPlayerDisplayName">
                                <small class="text-muted">
                                    No opponent yet
                                </small>
                            </template>

                        </div>
                    </div>
                </div>
                <div class="col-2">
                    <p class="m-0 p-0 text-center">
                        <b>${ playersGame.rows }&times;${ playersGame.columns }</b>
                    </p>
                    <p class="m-0 p-0 text-center">
                        <small>
                            grid
                        </small>
                    </p>
                </div>
                <div class="col-2">
                    <p class="m-0 p-0 text-center">
                        <b>${ playersGame.mines }</b>
                    </p>
                    <p class="m-0 p-0 text-center">
                        <small>
                            mines
                        </small>
                    </p>
                </div>
                <div class="col-2 text-right">
                    <a route-href="route: game; params.bind: { gameId: playersGame.gameId }"
                        class="btn btn-info btn-sm">
                        <i class="fas fa-play"></i>
                        <span class="ml-1">
                            Play
                        </span>
                    </a>
                </div>

            </div>

        </template>
    </template>

</template>
